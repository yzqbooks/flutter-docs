"use strict";(self.webpackChunkflutter_docs=self.webpackChunkflutter_docs||[]).push([[9737],{11100:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t=JSON.parse('{"key":"v-6398ac71","path":"/chapter9/stagger_animation.html","title":"9.5 交织动画","lang":"zh-CN","frontmatter":{},"headers":[{"level":3,"title":"示例","slug":"示例","link":"#示例","children":[]}],"git":{"createdTime":1654491188000,"updatedTime":1654491188000,"contributors":[{"name":"yzqdev","email":"yzqdev@outlook.com","commits":1}]},"readingTime":{"minutes":2.77,"words":830},"filePathRelative":"chapter9/stagger_animation.md","localizedDate":"2022年6月6日","excerpt":""}')},17641:(n,s,a)=>{a.r(s),a.d(s,{default:()=>d});var t=a(6808);const p=a.p+"assets/img/9-3.46bab4f6.gif",e=(0,t._)("h1",{id:"_9-5-交织动画",tabindex:"-1"},[(0,t._)("a",{class:"header-anchor",href:"#_9-5-交织动画","aria-hidden":"true"},"#"),(0,t.Uk)(" 9.5 交织动画")],-1),c=(0,t._)("p",null,"有些时候我们可能会需要一些复杂的动画，这些动画可能由一个动画序列或重叠的动画组成，比如：有一个柱状图，需要在高度增长的同时改变颜色，等到增长到最大高度后，我们需要在X轴上平移一段距离。可以发现上述场景在不同阶段包含了多种动画，要实现这种效果，使用交织动画（Stagger Animation）会非常简单。交织动画需要注意以下几点：",-1),o=(0,t._)("ol",null,[(0,t._)("li",null,[(0,t.Uk)("要创建交织动画，需要使用多个动画对象（"),(0,t._)("code",null,"Animation"),(0,t.Uk)("）。")]),(0,t._)("li",null,[(0,t.Uk)("一个"),(0,t._)("code",null,"AnimationController"),(0,t.Uk)("控制所有的动画对象。")]),(0,t._)("li",null,"给每一个动画对象指定时间间隔（Interval）")],-1),l={href:"https://docs.flutter.io/flutter/animation/AnimationController-class.html",target:"_blank",rel:"noopener noreferrer"},i={href:"https://docs.flutter.io/flutter/animation/Tween-class.html",target:"_blank",rel:"noopener noreferrer"},u=(0,t.uE)('<h3 id="示例" tabindex="-1"><a class="header-anchor" href="#示例" aria-hidden="true">#</a> 示例</h3><p>下面我们看一个例子，实现一个柱状图增长的动画：</p><ol><li>开始时高度从0增长到300像素，同时颜色由绿色渐变为红色；这个过程占据整个动画时间的60%。</li><li>高度增长到300后，开始沿X轴向右平移100像素；这个过程占用整个动画时间的40%。</li></ol><p>我们将执行动画的Widget分离出来：</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">StaggerAnimation</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>\n  <span class="token class-name">StaggerAnimation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    <span class="token class-name">Key</span><span class="token operator">?</span> key<span class="token punctuation">,</span>\n    required <span class="token keyword">this</span><span class="token punctuation">.</span>controller<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">//高度动画</span>\n    height <span class="token operator">=</span> <span class="token class-name">Tween</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>\n      begin<span class="token punctuation">:</span> <span class="token number">.0</span><span class="token punctuation">,</span>\n      end<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>\n      <span class="token class-name">CurvedAnimation</span><span class="token punctuation">(</span>\n        parent<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>\n        curve<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Interval</span><span class="token punctuation">(</span>\n          <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token comment">//间隔，前60%的动画时间</span>\n          curve<span class="token punctuation">:</span> <span class="token class-name">Curves</span><span class="token punctuation">.</span>ease<span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    color <span class="token operator">=</span> <span class="token class-name">ColorTween</span><span class="token punctuation">(</span>\n      begin<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>green<span class="token punctuation">,</span>\n      end<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>\n      <span class="token class-name">CurvedAnimation</span><span class="token punctuation">(</span>\n        parent<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>\n        curve<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Interval</span><span class="token punctuation">(</span>\n          <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token comment">//间隔，前60%的动画时间</span>\n          curve<span class="token punctuation">:</span> <span class="token class-name">Curves</span><span class="token punctuation">.</span>ease<span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    padding <span class="token operator">=</span> <span class="token class-name">Tween</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EdgeInsets</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>\n      begin<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      end<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>\n      <span class="token class-name">CurvedAnimation</span><span class="token punctuation">(</span>\n        parent<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>\n        curve<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Interval</span><span class="token punctuation">(</span>\n          <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token comment">//间隔，后40%的动画时间</span>\n          curve<span class="token punctuation">:</span> <span class="token class-name">Curves</span><span class="token punctuation">.</span>ease<span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  late <span class="token keyword">final</span> <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">&gt;</span></span> controller<span class="token punctuation">;</span>\n  late <span class="token keyword">final</span> <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">&gt;</span></span> height<span class="token punctuation">;</span>\n  late <span class="token keyword">final</span> <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EdgeInsets</span><span class="token punctuation">&gt;</span></span> padding<span class="token punctuation">;</span>\n  late <span class="token keyword">final</span> <span class="token class-name">Animation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Color</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> color<span class="token punctuation">;</span>\n\n  <span class="token class-name">Widget</span> <span class="token function">_buildAnimation</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">,</span> child<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>\n      alignment<span class="token punctuation">:</span> <span class="token class-name">Alignment</span><span class="token punctuation">.</span>bottomCenter<span class="token punctuation">,</span>\n      padding<span class="token punctuation">:</span> padding<span class="token punctuation">.</span>value<span class="token punctuation">,</span>\n      child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>\n        color<span class="token punctuation">:</span> color<span class="token punctuation">.</span>value<span class="token punctuation">,</span>\n        width<span class="token punctuation">:</span> <span class="token number">50.0</span><span class="token punctuation">,</span>\n        height<span class="token punctuation">:</span> height<span class="token punctuation">.</span>value<span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token metadata function">@override</span>\n  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token class-name">AnimatedBuilder</span><span class="token punctuation">(</span>\n      builder<span class="token punctuation">:</span> _buildAnimation<span class="token punctuation">,</span>\n      animation<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>StaggerAnimation</code>中定义了三个动画，分别是对<code>Container</code>的<code>height</code>、<code>color</code>、<code>padding</code>属性设置的动画，然后通过<code>Interval</code>来为每个动画指定在整个动画过程中的起始点和终点。下面我们来实现启动动画的路由：</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">StaggerRoute</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>\n  <span class="token metadata function">@override</span>\n  _StaggerRouteState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_StaggerRouteState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> _StaggerRouteState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StaggerRoute</span><span class="token punctuation">&gt;</span></span>\n    <span class="token keyword">with</span> <span class="token class-name">TickerProviderStateMixin</span> <span class="token punctuation">{</span>\n  late <span class="token class-name">AnimationController</span> _controller<span class="token punctuation">;</span>\n\n  <span class="token metadata function">@override</span>\n  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    _controller <span class="token operator">=</span> <span class="token class-name">AnimationController</span><span class="token punctuation">(</span>\n      duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">_playAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token comment">//先正向执行动画</span>\n      <span class="token keyword">await</span> _controller<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>orCancel<span class="token punctuation">;</span>\n      <span class="token comment">//再反向执行动画</span>\n      <span class="token keyword">await</span> _controller<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>orCancel<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">on</span> <span class="token class-name">TickerCanceled</span> <span class="token punctuation">{</span>\n      <span class="token comment">// the animation got canceled, probably because we were disposed</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token metadata function">@override</span>\n  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>\n      child<span class="token punctuation">:</span> <span class="token class-name">Column</span><span class="token punctuation">(</span>\n        children<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token class-name">ElevatedButton</span><span class="token punctuation">(</span>\n            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_playAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            child<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;start animation&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          <span class="token punctuation">)</span><span class="token punctuation">,</span>\n          <span class="token class-name">Container</span><span class="token punctuation">(</span>\n            width<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>\n            height<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>\n            decoration<span class="token punctuation">:</span> <span class="token class-name">BoxDecoration</span><span class="token punctuation">(</span>\n              color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>black<span class="token punctuation">.</span><span class="token function">withOpacity</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              border<span class="token punctuation">:</span> <span class="token class-name">Border</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>\n                color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>black<span class="token punctuation">.</span><span class="token function">withOpacity</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              <span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token comment">//调用我们定义的交错动画Widget</span>\n            child<span class="token punctuation">:</span> <span class="token class-name">StaggerAnimation</span><span class="token punctuation">(</span>controller<span class="token punctuation">:</span> _controller<span class="token punctuation">)</span><span class="token punctuation">,</span>\n          <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行效果如图9-3所示：</p><p><img src="'+p+'" alt="图9-3"></p>',9),k={},d=(0,a(18580).Z)(k,[["render",function(n,s){const a=(0,t.up)("ExternalLinkIcon");return(0,t.wg)(),(0,t.iD)("div",null,[e,c,o,(0,t._)("p",null,[(0,t.Uk)("所有动画都由同一个"),(0,t._)("a",l,[(0,t.Uk)("AnimationController"),(0,t.Wm)(a)]),(0,t.Uk)("驱动，无论动画需要持续多长时间，控制器的值必须在0.0到1.0之间，而每个动画的间隔（Interval）也必须介于0.0和1.0之间。对于在间隔中设置动画的每个属性，需要分别创建一个"),(0,t._)("a",i,[(0,t.Uk)("Tween"),(0,t.Wm)(a)]),(0,t.Uk)(" 用于指定该属性的开始值和结束值。也就是说0.0到1.0代表整个动画过程，我们可以给不同动画指定不同的起始点和终止点来决定它们的开始时间和终止时间。")]),u])}]])},18580:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);