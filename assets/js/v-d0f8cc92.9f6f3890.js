"use strict";(self.webpackChunkflutter_docs=self.webpackChunkflutter_docs||[]).push([[2426],{69869:(n,s,a)=>{a.r(s),a.d(s,{data:()=>t});const t=JSON.parse('{"key":"v-d0f8cc92","path":"/chapter15/language_and_theme_setting.html","title":"15.8 多语言和多主题","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"15.8.1 语言选择页","slug":"_15-8-1-语言选择页","link":"#_15-8-1-语言选择页","children":[]},{"level":2,"title":"15.8.2 主题选择页","slug":"_15-8-2-主题选择页","link":"#_15-8-2-主题选择页","children":[]}],"git":{"createdTime":1654491188000,"updatedTime":1654491188000,"contributors":[{"name":"yzqdev","email":"yzqdev@outlook.com","commits":1}]},"readingTime":{"minutes":2.15,"words":644},"filePathRelative":"chapter15/language_and_theme_setting.md","localizedDate":"2022年6月6日","excerpt":""}')},36312:(n,s,a)=>{a.r(s),a.d(s,{default:()=>i});var t=a(6808);const p=a.p+"assets/img/15-6.0e99992b.png",e=a.p+"assets/img/15-7.879ddfec.png",c=a.p+"assets/img/15-8.30ffc711.png",o=[(0,t.uE)('<h1 id="_15-8-多语言和多主题" tabindex="-1"><a class="header-anchor" href="#_15-8-多语言和多主题" aria-hidden="true">#</a> 15.8 多语言和多主题</h1><p>本实例APP中语言和主题都是可以设置的，而两者都是通过<code>ChangeNotifierProvider</code>来实现的：我们在<code>main</code>函数中使用了<code>Consumer2</code>，依赖了<code>ThemeModel</code>和<code>LocaleModel</code>，因此，当我们在语言和主题设置页更该当前的配置后，<code>Consumer2</code>的<code>builder</code>都会重新执行，构建一个新的<code>MaterialApp</code>，所以修改会立即生效。下面看一下语言和主题设置页的实现。</p><h2 id="_15-8-1-语言选择页" tabindex="-1"><a class="header-anchor" href="#_15-8-1-语言选择页" aria-hidden="true">#</a> 15.8.1 语言选择页</h2><p>APP语言选择页提供三个选项：中文简体、美国英语、跟随系统。我们将当前APP使用的语言高亮显示，并且在后面添加一个“对号”图标，实现如下：</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">&#39;../index.dart&#39;</span></span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">LanguageRoute</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>\n  <span class="token metadata function">@override</span>\n  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token class-name">Theme</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>primaryColor<span class="token punctuation">;</span>\n    <span class="token keyword">var</span> localeModel <span class="token operator">=</span> <span class="token class-name">Provider</span><span class="token punctuation">.</span>of<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LocaleModel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> gm <span class="token operator">=</span> <span class="token class-name">GmLocalizations</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token class-name">Widget</span> <span class="token function">_buildLanguageItem</span><span class="token punctuation">(</span><span class="token class-name">String</span> lan<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token class-name">ListTile</span><span class="token punctuation">(</span>\n        title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>\n          lan<span class="token punctuation">,</span>\n          <span class="token comment">// 对APP当前语言进行高亮显示</span>\n          style<span class="token punctuation">:</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> localeModel<span class="token punctuation">.</span>locale <span class="token operator">==</span> value <span class="token operator">?</span> color <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        trailing<span class="token punctuation">:</span>\n            localeModel<span class="token punctuation">.</span>locale <span class="token operator">==</span> value <span class="token operator">?</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>done<span class="token punctuation">,</span> color<span class="token punctuation">:</span> color<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n        onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// 此行代码会通知MaterialApp重新build</span>\n          localeModel<span class="token punctuation">.</span>locale <span class="token operator">=</span> value<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>\n      appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span>\n        title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span>gm<span class="token punctuation">.</span>language<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n      body<span class="token punctuation">:</span> <span class="token class-name">ListView</span><span class="token punctuation">(</span>\n        children<span class="token punctuation">:</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span>\n          <span class="token function">_buildLanguageItem</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;中文简体&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;zh_CN&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          <span class="token function">_buildLanguageItem</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;English&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;en_US&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          <span class="token function">_buildLanguageItem</span><span class="token punctuation">(</span>gm<span class="token punctuation">.</span>auto<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码逻辑很简单，唯一需要注意的是我们在<code>build(…)</code>方法里面定义了<code>_buildLanguageItem(…)</code>方法，它和在<code>LanguageRoute</code>类中定义该方法的区别就在于：在<code>build(…)</code>内定义的方法可以共享<code>build(...)</code>方法上下文中的变量，本例中是共享了<code>localeModel</code>。当然，如果<code>_buildLanguageItem(…)</code>的实现复杂一些的话不建议这样做，此时最好是将其作为<code>LanguageRoute</code>类的方法。该页面运行效果如图15-6、15-7所示：</p><p><img src="'+p+'" alt="15-6"><img src="'+e+'" alt="15-7"></p><p>切换语言后立即生效。</p><h2 id="_15-8-2-主题选择页" tabindex="-1"><a class="header-anchor" href="#_15-8-2-主题选择页" aria-hidden="true">#</a> 15.8.2 主题选择页</h2><p>一个完整的主题<code>Theme</code>包括很多选项，这些选项在<code>ThemeData</code>中定义。本实例为了简单起见，我们只配置主题颜色。我们提供几种默认预定义的主题色供用户选择，用户点击一种色块后则更新主题。主题选择页的实现代码如下：</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token keyword">class</span> <span class="token class-name">ThemeChangeRoute</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span><span class="token punctuation">{</span>\n  <span class="token metadata function">@override</span>\n  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>\n      appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span>\n        title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token class-name">GmLocalizations</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>theme<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n      body<span class="token punctuation">:</span> <span class="token class-name">ListView</span><span class="token punctuation">(</span> <span class="token comment">//显示主题色块</span>\n        children<span class="token punctuation">:</span> <span class="token class-name">Global</span><span class="token punctuation">.</span>themes<span class="token punctuation">.</span>map<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token class-name">GestureDetector</span><span class="token punctuation">(</span>\n            child<span class="token punctuation">:</span> <span class="token class-name">Padding</span><span class="token punctuation">(</span>\n              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">EdgeInsets</span><span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> horizontal<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>\n                color<span class="token punctuation">:</span> e<span class="token punctuation">,</span>\n                height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>\n              <span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token punctuation">)</span><span class="token punctuation">,</span>\n            onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token comment">//主题更新后，MaterialApp会重新build</span>\n              <span class="token class-name">Provider</span><span class="token punctuation">.</span>of<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeModel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> listen<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>theme <span class="token operator">=</span> e<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行效果如图15-8所示：</p><p><img src="'+c+'" alt="15-8"></p><p>点击其它主题色块后，APP主题色立马切换生效。</p>',14)],l={},i=(0,a(18580).Z)(l,[["render",function(n,s){return(0,t.wg)(),(0,t.iD)("div",null,o)}]])},18580:(n,s)=>{s.Z=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}}}]);